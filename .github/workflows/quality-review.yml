name: Quality Review
permissions:
  contents: read

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  quality-review:
    name: Quality Review
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install homeassistant==2024.12.0
          pip install ruff

      - name: Run Ruff linter
        run: |
          ruff check custom_components/ || echo "Ruff linting found issues (allowed for now)"
        continue-on-error: true

      - name: Run Ruff formatter check
        run: |
          ruff format --check custom_components/ || echo "Ruff formatting found issues (allowed for now)"
        continue-on-error: true

      - name: Validate Python syntax
        run: |
          python -m py_compile custom_components/jarolift/__init__.py
          python -m py_compile custom_components/jarolift/cover.py

      - name: Validate manifest.json
        run: |
          python -c "import json; json.load(open('custom_components/jarolift/manifest.json'))"

      - name: Validate services.yaml
        run: |
          pip install pyyaml
          python -c "import yaml; yaml.safe_load(open('custom_components/jarolift/services.yaml'))"

      - name: Check for common issues
        run: |
          # Check for print statements (should use logging)
          if grep -r "print(" custom_components/jarolift/*.py; then
            echo "Error: Found print() statements. Use _LOGGER instead."
            exit 1
          fi
          echo "No print() statements found - good!"

  hacs-validation:
    name: HACS Validation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: HACS validation
        uses: hacs/action@main
        with:
          category: integration
